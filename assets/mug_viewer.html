<!--&lt;!&ndash;try 1 - using cdn.skypack &ndash;&gt;-->
<!--<!DOCTYPE html>-->
<!--<html lang="en">-->
<!--<head>-->
<!--    <meta charset="UTF-8" />-->
<!--    <title>Mug Viewer</title>-->
<!--    <style>-->
<!--        body { margin: 0; overflow: hidden; }-->
<!--        canvas { display: block; }-->
<!--    </style>-->
<!--</head>-->
<!--<body>-->
<!--<script type="module">-->
<!--    import * as THREE from 'https://cdn.skypack.dev/three';-->
<!--    import { GLTFLoader } from 'https://cdn.skypack.dev/three/examples/jsm/loaders/GLTFLoader.js';-->
<!--    import { OrbitControls } from 'https://cdn.skypack.dev/three/examples/jsm/controls/OrbitControls.js';-->

<!--    const scene = new THREE.Scene();-->
<!--    const camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 0.1, 100);-->
<!--    camera.position.z = 3;-->

<!--    const renderer = new THREE.WebGLRenderer({ antialias: true });-->
<!--    renderer.setSize(window.innerWidth, window.innerHeight);-->
<!--    document.body.appendChild(renderer.domElement);-->

<!--    const light = new THREE.DirectionalLight(0xffffff, 1);-->
<!--    light.position.set(5, 5, 5);-->
<!--    scene.add(light);-->

<!--    const controls = new OrbitControls(camera, renderer.domElement);-->

<!--    const loader = new GLTFLoader();-->
<!--    loader.load('white_mug.glb', function (gltf) {-->
<!--      const mug = gltf.scene;-->
<!--      const texture = new THREE.TextureLoader().load('image2.png');-->

<!--      mug.traverse(function (child) {-->
<!--        if (child.isMesh) {-->
<!--          child.material.map = texture;-->
<!--          child.material.needsUpdate = true;-->
<!--        }-->
<!--      });-->

<!--      scene.add(mug);-->
<!--      animate();-->
<!--    });-->

<!--    function animate() {-->
<!--      requestAnimationFrame(animate);-->
<!--      controls.update();-->
<!--      renderer.render(scene, camera);-->
<!--    }-->

<!--</script>-->
<!--</body>-->
<!--</html>-->



<!-- try 2 with ems.sh in place of cds-->
<!--<!DOCTYPE html>-->
<!--<html lang="en">-->
<!--<head>-->
<!--    <meta charset="UTF-8" />-->
<!--    <title>Mug Viewer</title>-->
<!--    <style>-->
<!--        body { margin: 0; overflow: hidden; }-->
<!--        canvas { display: block; }-->
<!--    </style>-->
<!--</head>-->
<!--<body>-->
<!--<script type="module">-->
<!--    import * as THREE from 'https://esm.sh/three';-->
<!--    import { GLTFLoader } from 'https://esm.sh/three/examples/jsm/loaders/GLTFLoader.js';-->
<!--    import { OrbitControls } from 'https://esm.sh/three/examples/jsm/controls/OrbitControls.js';-->

<!--    const scene = new THREE.Scene();-->
<!--    const camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 0.1, 100);-->
<!--    camera.position.z = 3;-->

<!--    const renderer = new THREE.WebGLRenderer({ antialias: true });-->
<!--    renderer.setSize(window.innerWidth, window.innerHeight);-->
<!--    document.body.appendChild(renderer.domElement);-->

<!--    const light = new THREE.DirectionalLight(0xffffff, 1);-->
<!--    light.position.set(5, 5, 5);-->
<!--    scene.add(light);-->

<!--    const controls = new OrbitControls(camera, renderer.domElement);-->

<!--    const loader = new GLTFLoader();-->
<!--    loader.load('white_mug.glb', function (gltf) {-->
<!--      const mug = gltf.scene;-->
<!--      const texture = new THREE.TextureLoader().load('image2.png');-->

<!--      mug.traverse(function (child) {-->
<!--        if (child.isMesh) {-->
<!--          child.material.map = texture;-->
<!--          child.material.needsUpdate = true;-->
<!--        }-->
<!--      });-->

<!--      scene.add(mug);-->
<!--      animate();-->
<!--    });-->

<!--    function animate() {-->
<!--      requestAnimationFrame(animate);-->
<!--      controls.update();-->
<!--      renderer.render(scene, camera);-->
<!--    }-->

<!--</script>-->
<!--</body>-->
<!--</html>-->


<!--&lt;!&ndash;<!DOCTYPE html>&ndash;&gt;-->
<!--&lt;!&ndash;<html>&ndash;&gt;-->
<!--&lt;!&ndash;<head>&ndash;&gt;-->
<!--&lt;!&ndash;    <meta charset="utf-8">&ndash;&gt;-->
<!--&lt;!&ndash;    <title>Mug Viewer</title>&ndash;&gt;-->
<!--&lt;!&ndash;    <style> body { margin: 0; } canvas { display: block; } </style>&ndash;&gt;-->
<!--&lt;!&ndash;</head>&ndash;&gt;-->
<!--&lt;!&ndash;<body>&ndash;&gt;-->
<!--&lt;!&ndash;<script type="module">&ndash;&gt;-->
<!--&lt;!&ndash;    import * as THREE from 'https://esm.sh/three';&ndash;&gt;-->
<!--&lt;!&ndash;    import { GLTFLoader } from 'https://esm.sh/three/examples/jsm/loaders/GLTFLoader.js';&ndash;&gt;-->
<!--&lt;!&ndash;    import { OrbitControls } from 'https://esm.sh/three/examples/jsm/controls/OrbitControls.js';&ndash;&gt;-->

<!--&lt;!&ndash;    const scene = new THREE.Scene();&ndash;&gt;-->
<!--&lt;!&ndash;    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 100);&ndash;&gt;-->
<!--&lt;!&ndash;    camera.position.z = 3;&ndash;&gt;-->

<!--&lt;!&ndash;    const renderer = new THREE.WebGLRenderer({ antialias: true });&ndash;&gt;-->
<!--&lt;!&ndash;    renderer.setSize(window.innerWidth, window.innerHeight);&ndash;&gt;-->
<!--&lt;!&ndash;    document.body.appendChild(renderer.domElement);&ndash;&gt;-->

<!--&lt;!&ndash;    const light = new THREE.DirectionalLight(0xffffff, 1);&ndash;&gt;-->
<!--&lt;!&ndash;    light.position.set(5, 5, 5);&ndash;&gt;-->
<!--&lt;!&ndash;    scene.add(light);&ndash;&gt;-->

<!--&lt;!&ndash;    const controls = new OrbitControls(camera, renderer.domElement);&ndash;&gt;-->

<!--&lt;!&ndash;    // Replace with base64 strings from Flutter&ndash;&gt;-->
<!--&lt;!&ndash;    const base64GLB = "__GLB_BASE64__";&ndash;&gt;-->
<!--&lt;!&ndash;    const base64PNG = "__PNG_BASE64__";&ndash;&gt;-->

<!--&lt;!&ndash;    const binary = atob(base64GLB);&ndash;&gt;-->
<!--&lt;!&ndash;    const bytes = new Uint8Array(binary.length);&ndash;&gt;-->
<!--&lt;!&ndash;    for (let i = 0; i < binary.length; i++) {&ndash;&gt;-->
<!--&lt;!&ndash;      bytes[i] = binary.charCodeAt(i);&ndash;&gt;-->
<!--&lt;!&ndash;    }&ndash;&gt;-->

<!--&lt;!&ndash;    const blob = new Blob([bytes], { type: "model/gltf-binary" });&ndash;&gt;-->
<!--&lt;!&ndash;    const url = URL.createObjectURL(blob);&ndash;&gt;-->

<!--&lt;!&ndash;    const loader = new GLTFLoader();&ndash;&gt;-->
<!--&lt;!&ndash;    loader.load(url, function (gltf) {&ndash;&gt;-->
<!--&lt;!&ndash;      const mug = gltf.scene;&ndash;&gt;-->
<!--&lt;!&ndash;      const texture = new THREE.TextureLoader().load(base64PNG);&ndash;&gt;-->
<!--&lt;!&ndash;      mug.traverse(child => {&ndash;&gt;-->
<!--&lt;!&ndash;        if (child.isMesh) {&ndash;&gt;-->
<!--&lt;!&ndash;          child.material.map = texture;&ndash;&gt;-->
<!--&lt;!&ndash;          child.material.needsUpdate = true;&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->
<!--&lt;!&ndash;      });&ndash;&gt;-->
<!--&lt;!&ndash;      scene.add(mug);&ndash;&gt;-->
<!--&lt;!&ndash;      animate();&ndash;&gt;-->
<!--&lt;!&ndash;    });&ndash;&gt;-->

<!--&lt;!&ndash;    function animate() {&ndash;&gt;-->
<!--&lt;!&ndash;      requestAnimationFrame(animate);&ndash;&gt;-->
<!--&lt;!&ndash;      controls.update();&ndash;&gt;-->
<!--&lt;!&ndash;      renderer.render(scene, camera);&ndash;&gt;-->
<!--&lt;!&ndash;    }&ndash;&gt;-->
<!--&lt;!&ndash;</script>&ndash;&gt;-->
<!--&lt;!&ndash;</body>&ndash;&gt;-->
<!--&lt;!&ndash;</html>&ndash;&gt;-->





<!--aproach 3-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>3D Viewer</title>
    <style>
        html, body {
          margin: 0;
          overflow: hidden;
        }
        canvas {
          width: 100%;
          height: 100%;
        }
    </style>
</head>
<body>
<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/examples/js/loaders/GLTFLoader.js"></script>

<script>
    let scene, camera, renderer, model;

    function init() {
      scene = new THREE.Scene();
      camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
      renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      document.body.appendChild(renderer.domElement);

      const light = new THREE.HemisphereLight(0xffffff, 0x444444);
      light.position.set(0, 20, 0);
      scene.add(light);

      camera.position.z = 2;

      const loader = new THREE.GLTFLoader();
<!--      loader.load('https://modelviewer.dev/shared-assets/models/Astronaut.glb', function(gltf) {-->
        window.addEventListener('message', (event) => {
  const data = JSON.parse(event.data);
  if (data.type === 'loadModel') {
    const url = data.base64;
    const loader = new THREE.GLTFLoader();
    loader.load(url, function(gltf) {
      scene.add(gltf.scene);
      model = gltf.scene;
    });
  } else if (data.type === 'updateTexture') {
    updateTexture(data.base64);
  }
});

        model = gltf.scene;
        scene.add(model);
      });

      animate();
    }

    function animate() {
      requestAnimationFrame(animate);
      if (model) model.rotation.y += 0.005;
      renderer.render(scene, camera);
    }

    function updateTexture(base64) {
      if (!model) return;
      const texture = new THREE.TextureLoader().load(base64);
      model.traverse(function(child) {
        if (child.isMesh) {
          child.material.map = texture;
          child.material.needsUpdate = true;
        }
      });
    }

    window.addEventListener('message', (event) => {
      const data = JSON.parse(event.data);
      if (data.type === 'updateTexture') {
        updateTexture(data.base64);
      }
    });

    init();
</script>
</body>
</html>
